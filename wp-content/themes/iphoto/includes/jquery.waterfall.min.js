/**
 * @name jQuery waterfall Plugin
 * @version 1.0.2
 * @create 2012.1.30
 * @lastmodified 2012.1.31
 * @description Based on jQuery 1.4+
 * @author MuFeng (http://mufeng.me)
 * @url http://mufeng.me/waterfall.html
 **/
~function(b){var d=[],c=function(e,f){this.options=e;this.element=b(f);this.init()};c.prototype={init:function(){this.initArg();this.reSize();this.ajaxData();this.layout(this.bricks)},filterBricks:function(f){var e=this.options.itemSelector;return $bricks=!e?f.children().not(".waterfall"):f.filter(e).not(".waterfall").add(f.find(e))},getBricks:function(f){var e=this.options.itemSelector;return $bricks=!e?f.children():f.filter(e).add(f.find(e))},getSize:function(){this.bricks=this.getBricks(this.element);var k=this.bricks[0],i=b(k),l=this.options.columnCount,e=this.options.columnWidth,j=[],h=i.outerWidth(true),f=b(window).width()-20,m=!e?h:e,g=!l?parseInt(f/m):l;return j.concat(m,g)},initArg:function(){if(!this.options.isAppend){var e,g=this.getSize(),f=g[1];for(e=0;e<f;e++){d[e]=0}}},reSize:function(){this.element.css("position","relative");if(this.options.isResizable){var g=this.getSize(),f=g[1],e=g[0];this.element.css({width:f*e,margin:"0 auto"})}},ajaxData:function(){if(this.options.isAppend){this.bricks=this.filterBricks(this.element)}},layout:function(p){var l=0,q=this.element,e=p.length,g=this.options.isAnimated,o=this.options.Duration,f=this.options.Easing,u=this.options.endFn,m=this.getSize(),r=m[0],s;q.children().not(".waterfall").css("display","none");var h=(function(){var t=[],n=null,i=function(){var w=0;for(;w<t.length;w++){t[w].end?t.splice(w--,1):t[w]()}!t.length&&v()},v=function(){clearInterval(n);n=null};return function(H,z,A,I){var K,J,B,y,G,w=new Image();w.src=H;if(w.complete){z(w.width,w.height);A&&A(w.width,w.height);return}J=w.width;B=w.height;K=function(){y=w.width;G=w.height;if(y!==J||G!==B||y*G>1024){z(y,G);K.end=true}};K();w.onerror=function(){I&&I();y=0;G=0;z(y,G);K.end=true;w=w.onload=w.onerror=null};w.onload=function(){A&&A(w.width,w.height);!K.end&&K();w=w.onload=w.onerror=null};if(!K.end){t.push(K);if(n===null){n=setInterval(i,40)}}}})();k();function k(){if(l<e){var x=p[l],v=b(x),n=v.filter("img").add(v.find("img")),z=n.parent().width(),w=v.outerHeight(true),t=j(d);if(n.length>0){var i=n.attr("src");n.removeAttr("src").css("display","none");h(i,function(B,E){B=B?B:z;E=E?E:0;E=E*z/B;B=z;n.attr("src",i).css({width:B,height:E,display:"block"});var D=Math.max.apply(Math,d);q.height(D);v.addClass("waterfall");var C=v.outerHeight(true);!g?(v.css({display:"block",position:"absolute",left:t*r,top:d[t]})):(v.css({display:"block",position:"absolute",left:0,top:D}).animate({left:t*r,top:d[t]},{duration:o,easing:f}));d[t]+=C;l++;s=setTimeout(k,10)})}else{var A=Math.max.apply(Math,d);q.height(A);v.addClass("waterfall");var y=v.outerHeight(true);!g?(v.css({display:"block",position:"absolute",left:t*r,top:d[t]})):(v.css({display:"block",position:"absolute",left:0,top:A}).animate({left:t*r,top:d[t]},{duration:o,easing:f}));d[t]+=y;l++;s=setTimeout(k,10)}}else{if(l>=e){clearTimeout(s);s=null;var A=Math.max.apply(Math,d);q.height(A);if(typeof u=="function"){u.call(p)}}}}function j(n){var t,v=0,i=n[0],w=n.length;for(t=1;t<w;t++){if(n[t]<i){i=n[t];v=t}}return v}}};b.waterfall=function(e,f){e=b.extend({isResizable:false,isAnimated:false,isAppend:false,Duration:500,Easing:"swing",endFn:function(){}},e);b.data("waterfall",new c(e,f));return f};b.fn.waterfall=function(e){return b.waterfall(e,this)};function a(e){console.log({}.toString.call(e)+" | "+e)}}(jQuery);